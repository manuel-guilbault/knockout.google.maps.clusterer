/*
*   knockout.google.maps.clusterer 0.2.0 (2014-01-27)
*   Created by Manuel Guilbault (https://github.com/manuel-guilbault)
*
*   Source: https://github.com/manuel-guilbault/knockout.google.maps.clusterer
*   MIT License: http://www.opensource.org/licenses/MIT
*/!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko,ko.validation={})}(function(a){if(void 0===typeof a.google.maps)throw"knockout.google.maps is required, please ensure it is loaded before loading this plugin";!function(){function b(b){return a.utils.domData.get(b,"clusterer")}function c(c,d){var e=b(c);e&&e.removeMarker(c),a.utils.domData.set(c,"clusterer",d),d&&d.addMarker(c)}function d(a){c(a,void 0)}function e(b,c){if(a.isObservable(b)?b=b():void 0===b&&(b=g),!b)return void 0;var d=c[b];if(!d)throw new Error("Clusterer '"+b+"' is undefined");return d}function f(a,b){return a?b[a]:void 0}var g="$clusterer";a.bindingHandlers.clusterer={init:function(b,c,d,e,f){if(void 0===f.$map)throw"clusterer binding must be used only inside the scope of a map binding.";var h=a.utils.unwrapObservable(c()),i=a.google.maps.binder.getCreateOptions(f,h,a.bindingHandlers.clusterer.binders),j=new MarkerClusterer(f.$map,[],i),k=new a.google.maps.Subscriptions;a.google.maps.binder.bind(f,h,j,k,a.bindingHandlers.clusterer.binders);var l=a.utils.unwrapObservable(h.name)||g,m={};m[l]=j;var n=f.extend(m);return a.applyBindingsToDescendants(n,b),{controlsDescendantBindings:!0}},binders:{ignoreHidden:{createOptions:{name:"ignoreHidden",type:"bool"}},gridSize:{createOptions:"gridSize",bindings:{name:"gridSize",vmToObj:{setter:"setGridSize"}}},maxZoom:{createOptions:"maxZoom",bindings:{name:"maxZoom",vmToObj:{setter:"setMaxZoom"}}},styles:{createOptions:"styles",bindings:{name:"styles",vmToObj:{setter:function(a,b){a.setStyles(b),a.resetViewport(),a.redraw()}}}},calculator:{createOptions:"calculator"}}},a.virtualElements.allowedBindings.clusterer=!0,a.bindingHandlers.marker.binders.clusterer={bind:function(g,h,i,j){var k=e(h.clusterer,g);c(i,k),j.add(function(){d(i)}),a.isObservable(h.clusterer)&&j.addKOSubscription(h.clusterer.subscribe(function(a){var b=f(a,g);c(i,b)})),j.addGMListener(google.maps.event.addListener(i,"visible_changed",function(){var c=b(i);if(c){var d=a.utils.domData.get(c,"needsRepaint");d||(a.utils.domData.set(c,"needsRepaint",!0),setTimeout(function(){c.repaint(),a.utils.domData.set(c,"needsRepaint",!1)},0))}}))}}}()});